name: Test env var
on:
  push:
    branches:
      - envtest

env:
  PROFILE_TO_BUILD: simulator

jobs:
  test-env-vars:
    runs-on: ubuntu-latest
    environment: development

    steps:
      - name: 🏗 Setup repo
        uses: actions/checkout@v3
      - name: Hello world
        run: |
          echo "Hello world"

      - name: Compare environemnt variables
        run: |
          jq -r '.build.${{ env.PROFILE_TO_BUILD }}.env | to_entries | map("\(.key)=\"\(.value)\"" ) | .[]' ./eas.json | tee -a /tmp/env_vars_from_expo.txt
          echo "EXPO_PUBLIC_GRASS_COLOR=\"${{ vars.EXPO_PUBLIC_GRASS_COLOR}}\"" > /tmp/env_vars_from_github.txt
          echo "GRASS_COLOR=\"${{ vars.GRASS_COLOR}}\""                         >> /tmp/env_vars_from_github.txt
          if ! diff -du /tmp/env_vars_from_expo.txt /tmp/env_vars_from_github.txt; then
            echo "Environment variables on expo and GitHub not match!"
            exit 1
          fi


      - name: Set environment variable
        run: echo "MY_ENV_VAR=myValue" >> $GITHUB_ENV


      - name: Use eas.json environment variables2
        run: |
          echo npx ts-node ./scripts/extract_eas_env_vars.ts simulator $GITHUB_ENV
          jq -r '.build.${{ env.PROFILE_TO_BUILD }}.env | to_entries | map("\(.key)=\"\(.value)\"" ) | .[]' ./eas.json | tee -a $GITHUB_ENV

      - name: Show environment variable
        run: |
          echo $MY_ENV_VAR
          echo "$EXPO_PUBLIC_GRASS_COLOR"

      - name: Show all environment variables
        run: env

      - name: Do somethig
        uses: ./.github/workflows/local-action
        env:
          ANOTHER_ENV: "green"
