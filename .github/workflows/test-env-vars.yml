name: Expo build
on:
  push:
    branches:
      - envtest

env:
  PROFILE_TO_BUILD: simulator

jobs:
  expo-build:
    runs-on: ubuntu-latest

    steps:
      - name: 🏗 Setup repo
        uses: actions/checkout@v3
      - name: Hello world
        run: |
          echo "Hello world"

      - name: Set environment variable
        run: echo "MY_ENV_VAR=myValue" >> $GITHUB_ENV

      - name: Use eas.json environment variables2
        run: |
          echo npx ts-node ./scripts/extract_eas_env_vars.ts simulator $GITHUB_ENV
          jq -r '.build.${{ env.PROFILE_TO_BUILD }}.env | to_entries | map("\(.key)=\"\(.value)\"" ) | .[]' ./eas.json | tee -a $GITHUB_ENV

      - name: Show environment variable
        run: |
          echo $MY_ENV_VAR
          echo "$EXPO_PUBLIC_GRASS_COLOR"

      - name: Show all environment variables
        run: env

      - uses: ./.github/workflows/sub-workflow.yml
        env:
          ANOTHER_ENV: "green"
